import{R as S,r as w,aw as I,V as R,W as A,X as a,$ as l,Z as o,_ as c,x as k,b2 as y,a2 as g,aA as L,Y as j}from"./index.3de14beb.js";import{Q as b}from"./QTooltip.2c191821.js";import{Q as z}from"./QTd.4e40a178.js";import{Q as O}from"./QTable.bd81f58f.js";import{Q as F}from"./QPage.ea495e0d.js";import{_ as N}from"./ReaderForm.0f6c1019.js";import"./QMenu.ba121aec.js";import"./QList.d82f2d18.js";import"./QSelect.dcde8888.js";import"./QItem.5c0ffacc.js";import"./format.054b8074.js";import"./QForm.56ccee4c.js";import"./use-dialog-plugin-component.65dc1751.js";const U={class:"row justify-between items-center q-gutter-x-xl q-gutter-y-md q-mb-md q-pt-sm"},B={class:"col-md-6"},D={class:"row q-gutter-sm items-center"},G={class:"col-auto"},J={class:"row justify-between content-end items-center q-col-gutter-sm"},W={class:"col-auto"},X={class:"row items-center"},Y={class:"col-xs-12 col-lg-auto"},Z={class:"row items-center q-gutter-md"},H={class:"col-auto"},K={class:"col-auto"},M={class:"col-auto"},ee={class:"col-auto self-end"},be={__name:"ReaderList",setup(oe){const d=S(),p=w({page:1,rowsPerPage:10,rowsNumber:0}),s=I({cedula:"",nombre:"",apellido:"",direccion:"",telefono:"",correo:"",edad:"",sexo:""}),h=w([]),_=w(!1),E=[{name:"N",label:"N\xFAmero",field:"N",align:"left"},{name:"cedula",label:"Cedula",field:"cedula",align:"left"},{name:"nombre",label:"Nombre",field:"nombre",align:"left"},{name:"apellido",label:"Apellido",field:"apellido",align:"left"},{name:"telefono",label:"Tel\xE9fono",field:"telefono",align:"left"},{name:"correo",label:"Correo",field:"correo",align:"left"},{name:"edad",label:"Edad",field:"edad",align:"left"},{name:"sexo",label:"Sexo",field:"sexo",align:"left"},{name:"actions",label:"Acciones",align:"left"}],C=n=>{d.dialog({title:"Eliminar lector",message:`\xBFEst\xE1s seguro de que deseas eliminar este lector? (${n.nombre} ${n.apellido})`,cancel:!0,persistent:!0}).onOk(async()=>{try{const e={method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({N:n.N,session_user_name:localStorage.getItem("usuario"),session_user_role:localStorage.getItem("rol")})},i=await fetch("http://localhost/bibliostar/API/lectores.php",e);if(!i.ok)throw new Error(i.statusText);const u=await i.json();if(u.error)throw new Error(u.error);d.notify({color:"positive",position:"top",message:"Lector eliminado correctamente",icon:"mdi-check"}),m()}catch(e){d.notify({color:"negative",position:"top",message:e.message,icon:"mdi-alert"})}})},m=async(n=1)=>{var e,t,i;try{const u={method:"GET",headers:{"Content-Type":"application/json"}};let q=`http://localhost/bibliostar/API/lectores.php?page=${n}&session_user_name=${localStorage.getItem("usuario")}&session_user_role=${localStorage.getItem("rol")}`,f=new URLSearchParams(s),x=[];f.forEach((v,T)=>{v.trim()==""&&x.push(T)}),x.forEach(v=>{f.delete(v)}),f.toString()!=""&&(q+=`&${f.toString()}`),_.value=!0;const r=await(await fetch(q,u)).json();h.value=r.data?r.data:[],p.value.rowsNumber=(e=r.pagination)!=null&&e.total?r.pagination.total:0,p.value.page=(t=r.pagination)!=null&&t.currentPage?r.pagination.currentPage:1,p.value.rowsPerPage=(i=r.pagination)!=null&&i.perPage?r.pagination.perPage:10}catch(u){d.notify({color:"negative",position:"top",message:u.message,icon:"mdi-alert"})}finally{_.value=!1}},P=n=>{m(n.pagination.page)},V=()=>{s.cedula="",s.nombre="",s.apellido=""},Q=async()=>{d.dialog({component:N,componentProps:{creatingFromLoan:!1,isEditForm:!1}}).onOk(async n=>{m()})},$=async n=>{d.dialog({component:N,componentProps:{isEditForm:!0,cedula:n.cedula}}).onOk(async e=>{await m()})};return m(),(n,e)=>(R(),A(F,{class:"q-py-md q-px-lg"},{default:a(()=>[l("div",U,[l("div",B,[l("div",D,[o(c,{icon:"mdi-chevron-left",flat:"",color:"primary",padding:"none",to:"/prestamos",size:"lg",class:"col-md-1 q-mr-sm"}),o(k,{name:"mdi-library",size:"lg",color:"primary"}),e[5]||(e[5]=l("div",{class:"text-h4 text-weight-medium font-title"},"Lectores",-1))])]),l("div",G,[o(c,{label:"Nuevo lector",icon:"mdi-plus-circle",color:"secondary","text-color":"white",onClick:Q})])]),o(L,{class:"q-pa-md q-mb-lg"},{default:a(()=>[l("div",J,[l("div",W,[l("div",X,[l("div",Y,[l("div",Z,[o(k,{name:"mdi-filter-variant",size:"lg",color:"grey-10"}),l("div",H,[o(y,{modelValue:s.cedula,"onUpdate:modelValue":e[0]||(e[0]=t=>s.cedula=t),outlined:"",dense:"",debounce:"400",label:"Cedula"},null,8,["modelValue"])]),l("div",K,[o(y,{modelValue:s.nombre,"onUpdate:modelValue":e[1]||(e[1]=t=>s.nombre=t),outlined:"",dense:"",debounce:"400",label:"Nombre"},null,8,["modelValue"])]),l("div",M,[o(y,{modelValue:s.apellido,"onUpdate:modelValue":e[2]||(e[2]=t=>s.apellido=t),outlined:"",dense:"",debounce:"400",label:"Apellido"},null,8,["modelValue"])])])])])]),l("div",ee,[o(c,{flat:"",size:"lg","no-caps":"",icon:"mdi-eraser",color:"negative",onClick:V}),o(c,{flat:"",size:"lg","no-caps":"",icon:"mdi-reload",color:"primary",class:"q-ml-sm",onClick:e[3]||(e[3]=t=>m())},{default:a(()=>[o(b,null,{default:a(()=>e[6]||(e[6]=[g(" Actualizar tabla ")])),_:1})]),_:1})])])]),_:1}),o(O,{flat:"",dense:j(d).screen.lt.lg,bordered:"",pagination:p.value,"onUpdate:pagination":e[4]||(e[4]=t=>p.value=t),rows:h.value,columns:E,filter:s,loading:_.value,"row-key":"N","rows-per-page-options":[],onRequest:P},{"body-cell-actions":a(t=>[o(z,{props:t},{default:a(()=>[o(c,{flat:"",round:"",icon:"mdi-eye",color:"positive",to:`/lectores/lector/${t.row.N}`},{default:a(()=>[o(b,null,{default:a(()=>e[7]||(e[7]=[g("Ver")])),_:1})]),_:2},1032,["to"]),o(c,{flat:"",round:"",icon:"mdi-lead-pencil",color:"accent",onClick:i=>$(t.row)},{default:a(()=>[o(b,null,{default:a(()=>e[8]||(e[8]=[g("Editar")])),_:1})]),_:2},1032,["onClick"]),o(c,{flat:"",round:"",icon:"mdi-delete-variant",color:"red",onClick:i=>C(t.row)},{default:a(()=>[o(b,null,{default:a(()=>e[9]||(e[9]=[g("Eliminar")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["dense","pagination","rows","filter","loading"])]),_:1}))}};export{be as default};
