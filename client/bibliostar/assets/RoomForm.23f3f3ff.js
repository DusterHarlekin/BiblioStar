import{R as w,P as b,b1 as I,r as q,aw as C,bb as S,V as v,W as x,X as n,$ as a,Z as t,_ as p,x as E,a3 as Q,Y as i,aA as D,az as P,b2 as g}from"./index.3de14beb.js";import{Q as V}from"./QForm.56ccee4c.js";import{Q as k}from"./QPage.ea495e0d.js";import{d as N}from"./date.ca83aab8.js";import"./format.054b8074.js";const R={class:"flex justify-between"},O={class:"row q-gutter-sm items-center q-mb-md q-pt-sm"},T={class:"text-h5 text-weight-medium font-title text-grey-9"},$={class:"text-right font-title"},j={class:"row"},Y={class:"col-12"},M={__name:"RoomForm",setup(z){const c=w(),_=b(),d=I(),h=q(!1),m=!!(d.path.includes("editar")&&d.params.id),r=C({record:{cod_sala:"",DESCRIPCION:"",fecha_ing:N.formatDate(Date.now(),"DD/MM/YYYY"),session_user_name:localStorage.getItem("usuario"),session_user_role:localStorage.getItem("rol")}}),f=async()=>{try{if(m){const s={method:"GET",headers:{"Content-Type":"application/json"}},o=`http://localhost/bibliostar/API/salas.php?N=${d.params.id}&session_user_name=${localStorage.getItem("usuario")}&session_user_role=${localStorage.getItem("rol")}`,e=await fetch(o,s);if(!e.ok)throw new Error(e.statusText);const u=await e.json();if(u.error)throw new Error(u.error);r.record=u[0],r.record.session_user_name=localStorage.getItem("usuario"),r.record.session_user_role=localStorage.getItem("rol")}}catch(s){c.notify({color:"negative",position:"top",message:s.message,icon:"mdi-alert"})}},y=async()=>{try{const s={method:m?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r.record)},o=await fetch("http://localhost/bibliostar/API/salas.php",s);if(!o.ok)throw new Error(o.statusText);const e=await o.json();if(e.error)throw new Error(e.error);c.notify({color:"positive",position:"top",message:e.success,icon:"mdi-checkbox-marked-circle"}),_.push({path:"/salas"})}catch(s){c.notify({color:"negative",position:"top",message:s.message,icon:"mdi-alert"})}};f();const{record:l}=S(r);return(s,o)=>(v(),x(k,{class:"q-px-lg q-py-sm"},{default:n(()=>[a("div",R,[a("div",O,[t(p,{icon:"mdi-chevron-left",flat:"",color:"primary",padding:"none",to:"/salas",size:"lg",class:"q-mr-sm"}),t(E,{name:"mdi-home-search",size:"md",color:"grey-9"}),a("div",T,Q(i(m)?"Editar":"Nueva")+" Sala ",1)]),a("div",$,[t(p,{size:"md",class:"q-my-md",loading:h.value,color:"primary",padding:"sm md",icon:"mdi-check-circle-outline",label:"Guardar",onClick:y},null,8,["loading"])])]),t(V,null,{default:n(()=>[t(D,null,{default:n(()=>[a("div",j,[a("div",Y,[t(P,{class:"q-pb-none"},{default:n(()=>[t(g,{modelValue:i(l).cod_sala,"onUpdate:modelValue":o[0]||(o[0]=e=>i(l).cod_sala=e),label:"C\xF3digo de sala",class:"required q-my-md",outlined:""},null,8,["modelValue"]),t(g,{modelValue:i(l).DESCRIPCION,"onUpdate:modelValue":o[1]||(o[1]=e=>i(l).DESCRIPCION=e),label:"Descripci\xF3n",class:"required q-my-md",outlined:""},null,8,["modelValue"])]),_:1})])])]),_:1})]),_:1})]),_:1}))}};export{M as default};
