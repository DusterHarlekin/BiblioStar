import{R as M,P as J,b1 as W,r as b,aw as X,bb as Z,V as C,W as k,X as n,$ as u,Z as t,_ as $,x as H,a3 as K,Y as a,aA as ee,az as h,a2 as y,a0 as T,b2 as d,bc as oe,a6 as le}from"./index.3de14beb.js";import{Q as q,b as _}from"./QItem.5c0ffacc.js";import{Q as w}from"./QSelect.dcde8888.js";import{Q as te}from"./QForm.56ccee4c.js";import{Q as ae}from"./QPage.ea495e0d.js";import{d as se}from"./date.ca83aab8.js";import"./QMenu.ba121aec.js";import"./format.054b8074.js";const re={class:"flex justify-between"},ie={class:"row q-gutter-sm items-center q-mb-md q-pt-sm"},ne={class:"text-h5 text-weight-medium font-title text-grey-9"},de={class:"text-right font-title"},ue={class:"row"},me={class:"col-md-6 col-xs-12"},ce={class:"row q-py-none q-mb-none items-center"},pe={class:"col-12 col-lg-9"},be={class:"col-12 col-lg-3"},fe={key:0},ge={class:"col-md-6 col-xs-12"},xe={__name:"BookForm",setup(ve){const U=M(),j=J(),x=W(),P=b(!1),m=b(!0),S=b([]),v=b([]),F=b([]),Q=b([]),N=b([]),E=!!(x.path.includes("editar")&&x.params.id),l=X({record:{titulo:"",autor:"",editorial:"",edicion:"",cod_sala:"",tomo:"",anio:"",pag:"0",cod_referencia:"",costo:"0",impresion:"",isNewQuote:!0,fecha_ing:se.formatDate(Date.now(),"DD/MM/YYYY"),session_user_name:localStorage.getItem("usuario"),session_user_role:localStorage.getItem("rol")},cota:"",cod_isbn:"",cutter:"",volumen:"",ejemplar:"",cota_completa:"",cota_n:""}),O=()=>{N.value=[],l.record.ciudad=""},A=(r,e)=>{e(async()=>{if(r.length>0){let o=await V({cod_sala:r},"salas");if(S.value=[],o.data)for(const i of o.data)S.value.push({label:i.cod_sala,value:i.cod_sala})}})},B=(r,e)=>{e(async()=>{if(r.length>0){let o=await V({cota_completa:r},"cotas");if(v.value=[],o.data)for(const i of o.data)v.value.push({label:i.cota_completa,value:i.N})}})},D=(r,e)=>{e(async()=>{if(r.length>0){let o=await V({cod_idioma:r},"idiomas");if(F.value=[],o.data)for(const i of o.data)F.value.push({label:i.cod_idioma,value:i.cod_idioma})}})},G=(r,e)=>{e(async()=>{if(r.length>0){let o=await V({codigo:r},"paises");if(Q.value=[],o.data)for(const i of o.data)Q.value.push({label:`${i.codigo} - ${i.pais}`,value:i.codigo})}})},R=(r,e)=>{e(async()=>{if(r.length>0){let o=await V({codigo_ciudad:r,codigo_pais:l.record.pais},"ciudades");if(N.value=[],o.data)for(const i of o.data)N.value.push({label:i.codigo_ciudad,value:i.codigo_ciudad})}})},V=async(r,e)=>{try{const o={method:"GET",headers:{"Content-Type":"application/json"}};let i=`http://localhost/bibliostar/API/${e}.php?page=1&session_user_name=${localStorage.getItem("usuario")}&session_user_role=${localStorage.getItem("rol")}`,f=new URLSearchParams(r),g=[];f.forEach((I,L)=>{I.trim()==""&&g.push(L)}),g.forEach(I=>{f.delete(I)}),f.toString()!=""&&(i+=`&${f.toString()}`);const c=await fetch(i,o);if(!c.ok)throw new Error(c.statusText);const p=await c.json();if(p.error)throw new Error(p.error);return p}catch(o){U.notify({color:"negative",position:"top",message:o.message,icon:"mdi-alert"})}},Y=async()=>{try{if(E){const r={method:"GET",headers:{"Content-Type":"application/json"}},e=`http://localhost/bibliostar/API/libros.php?N=${x.params.id}&session_user_name=${localStorage.getItem("usuario")}&session_user_role=${localStorage.getItem("rol")}`,o=await fetch(e,r);if(!o.ok)throw new Error(o.statusText);const i=await o.json();if(i.error)throw new Error(i.error);l.record=i[0];const f=`http://localhost/bibliostar/API/cotas.php?cota_completa=${l.record.cota_completa}&session_user_name=${localStorage.getItem("usuario")}&session_user_role=${localStorage.getItem("rol")}`,g=await fetch(f,r);if(!g.ok)throw new Error(g.statusText);if(l.record.cota_completa.trim()!=""){const c=await g.json();if(c.error)throw new Error(c.error);let p=c.data?c.data[0]:null;p?(v.value=[],v.value.push({label:p.cota_completa,value:p.N}),l.cota_n=p.N):l.cota_n=""}l.record.session_user_name=localStorage.getItem("usuario"),l.record.session_user_role=localStorage.getItem("rol"),m.value=!1}}catch(r){U.notify({color:"negative",position:"top",message:r.message,icon:"mdi-alert"})}},z=async()=>{try{m.value?(l.record.cota=l.cota,l.record.cod_isbn=l.cod_isbn,l.record.cutter=l.cutter,l.record.volumen=l.volumen,l.record.ejemplar=l.ejemplar,l.record.cota_completa=l.cota_completa):(delete l.record.cota,delete l.record.cod_isbn,delete l.record.cutter,delete l.record.volumen,delete l.record.ejemplar,delete l.record.cota_completa,l.record.cota_n=l.cota_n),l.record.isNewQuote=m.value,l.record.participante="BPCPT",l.record.descripcion=l.record.descripcion?l.record.descripcion:"NINGUNA",l.record.observacion=l.record.observacion?l.record.observacion:"NINGUNA";const r={method:E?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l.record)},e=await fetch("http://localhost/bibliostar/API/libros.php",r);if(!e.ok)throw new Error(e.statusText);const o=await e.json();if(o.error)throw new Error(o.error);U.notify({color:"positive",position:"top",message:o.success,icon:"mdi-checkbox-marked-circle"}),j.push({path:"/libros"})}catch(r){U.notify({color:"negative",position:"top",message:r.message,icon:"mdi-alert"})}};Y();const{record:s}=Z(l);return(r,e)=>(C(),k(ae,{class:"q-px-lg q-py-sm"},{default:n(()=>[u("div",re,[u("div",ie,[t($,{icon:"mdi-chevron-left",flat:"",color:"primary",padding:"none",to:"/libros",size:"lg",class:"q-mr-sm"}),t(H,{name:"mdi-book",size:"md",color:"grey-9"}),u("div",ne,K(a(E)?"Editar":"Nuevo")+" Libro ",1)]),u("div",de,[t($,{size:"md",class:"q-my-md",loading:P.value,color:"primary",padding:"sm md",icon:"mdi-check-circle-outline",label:"Guardar",onClick:z},null,8,["loading"])])]),t(te,null,{default:n(()=>[t(ee,null,{default:n(()=>[u("div",ue,[u("div",me,[t(h,{class:"q-pb-none"},{default:n(()=>[u("div",ce,[u("div",pe,[m.value?T("",!0):(C(),k(w,{key:0,modelValue:l.cota_n,"onUpdate:modelValue":e[0]||(e[0]=o=>l.cota_n=o),label:"Cota completa",class:"required q-mt-md","use-input":"","input-debounce":"400","option-label":"label","option-value":"value","emit-value":"","map-options":"",outlined:"",options:v.value,onFilter:B},{"no-option":n(()=>[t(q,null,{default:n(()=>[t(_,{class:"text-grey"},{default:n(()=>e[24]||(e[24]=[y(" No se encontraron resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options"])),m.value?(C(),k(d,{key:1,modelValue:l.cota,"onUpdate:modelValue":e[1]||(e[1]=o=>l.cota=o),label:"Cota",class:"required q-mt-md",outlined:""},null,8,["modelValue"])):T("",!0)]),u("div",be,[t(oe,{class:"text-subtitle2",label:"Nueva cota",modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=o=>m.value=o)},null,8,["modelValue"])])]),m.value?(C(),le("div",fe,[t(d,{modelValue:l.cod_isbn,"onUpdate:modelValue":e[3]||(e[3]=o=>l.cod_isbn=o),label:"C\xF3digo ISBN",class:"required q-my-md",outlined:""},null,8,["modelValue"]),t(d,{modelValue:l.cutter,"onUpdate:modelValue":e[4]||(e[4]=o=>l.cutter=o),label:"Cutter",class:"required q-my-md",outlined:""},null,8,["modelValue"]),t(d,{modelValue:l.cota_completa,"onUpdate:modelValue":e[5]||(e[5]=o=>l.cota_completa=o),label:"Cota completa",class:"required q-my-md",outlined:""},null,8,["modelValue"]),t(d,{modelValue:l.volumen,"onUpdate:modelValue":e[6]||(e[6]=o=>l.volumen=o),label:"Volumen",class:"required q-my-md",outlined:""},null,8,["modelValue"]),t(d,{modelValue:l.ejemplar,"onUpdate:modelValue":e[7]||(e[7]=o=>l.ejemplar=o),label:"Ejemplares",class:"required q-my-md",outlined:""},null,8,["modelValue"])])):T("",!0),t(d,{modelValue:a(s).titulo,"onUpdate:modelValue":e[8]||(e[8]=o=>a(s).titulo=o),label:"T\xEDtulo",class:"required q-my-md",outlined:""},null,8,["modelValue"]),t(d,{modelValue:a(s).autor,"onUpdate:modelValue":e[9]||(e[9]=o=>a(s).autor=o),label:"Autor",class:"required q-my-md",outlined:""},null,8,["modelValue"]),t(d,{modelValue:a(s).editorial,"onUpdate:modelValue":e[10]||(e[10]=o=>a(s).editorial=o),label:"Editorial",class:"required q-my-md",outlined:""},null,8,["modelValue"]),t(d,{modelValue:a(s).edicion,"onUpdate:modelValue":e[11]||(e[11]=o=>a(s).edicion=o),label:"Edici\xF3n",class:"required q-my-md",outlined:""},null,8,["modelValue"]),t(d,{modelValue:a(s).descripcion,"onUpdate:modelValue":e[12]||(e[12]=o=>a(s).descripcion=o),label:"Descripci\xF3n",class:"required q-my-md",outlined:"",type:"textarea"},null,8,["modelValue"])]),_:1})]),u("div",ge,[t(h,{class:"q-pb-none"},{default:n(()=>[t(w,{modelValue:a(s).cod_sala,"onUpdate:modelValue":e[13]||(e[13]=o=>a(s).cod_sala=o),label:"Sala",class:"required q-mt-md","use-input":"","input-debounce":"400","option-label":"label","option-value":"value","emit-value":"","map-options":"",outlined:"",options:S.value,onFilter:A},{"no-option":n(()=>[t(q,null,{default:n(()=>[t(_,{class:"text-grey"},{default:n(()=>e[25]||(e[25]=[y(" No se encontraron resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options"]),t(d,{modelValue:a(s).tomo,"onUpdate:modelValue":e[14]||(e[14]=o=>a(s).tomo=o),label:"Tomo",class:"required q-my-md",outlined:""},null,8,["modelValue"]),t(d,{modelValue:a(s).anio,"onUpdate:modelValue":e[15]||(e[15]=o=>a(s).anio=o),label:"A\xF1o de publicaci\xF3n",class:"required q-my-md",outlined:""},null,8,["modelValue"]),t(d,{modelValue:a(s).pag,"onUpdate:modelValue":e[16]||(e[16]=o=>a(s).pag=o),label:"N\xFAmero de p\xE1ginas",class:"required q-my-md",outlined:""},null,8,["modelValue"]),t(d,{modelValue:a(s).cod_referencia,"onUpdate:modelValue":e[17]||(e[17]=o=>a(s).cod_referencia=o),label:"C\xF3digo de referencia",class:"required q-my-md",outlined:""},null,8,["modelValue"]),t(d,{modelValue:a(s).impresion,"onUpdate:modelValue":e[18]||(e[18]=o=>a(s).impresion=o),label:"Tipo de impresi\xF3n",class:"required q-my-md",outlined:""},null,8,["modelValue"]),t(w,{modelValue:a(s).idioma,"onUpdate:modelValue":e[19]||(e[19]=o=>a(s).idioma=o),label:"Idioma",class:"required q-mt-md","use-input":"","input-debounce":"400","option-label":"label","option-value":"value","emit-value":"","map-options":"",outlined:"",options:F.value,onFilter:D},{"no-option":n(()=>[t(q,null,{default:n(()=>[t(_,{class:"text-grey"},{default:n(()=>e[26]||(e[26]=[y(" No se encontraron resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options"]),t(w,{modelValue:a(s).pais,"onUpdate:modelValue":e[20]||(e[20]=o=>a(s).pais=o),label:"Pais",class:"required q-mt-md","use-input":"","input-debounce":"400","option-label":"label","option-value":"value","emit-value":"","map-options":"",outlined:"",options:Q.value,onFilter:G,onInput:O},{"no-option":n(()=>[t(q,null,{default:n(()=>[t(_,{class:"text-grey"},{default:n(()=>e[27]||(e[27]=[y(" No se encontraron resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options"]),t(w,{modelValue:a(s).ciudad,"onUpdate:modelValue":e[21]||(e[21]=o=>a(s).ciudad=o),label:"Ciudad",class:"required q-mt-md",disable:!a(s).pais,"use-input":"","input-debounce":"400","option-label":"label","option-value":"value","emit-value":"","map-options":"",outlined:"",options:N.value,onFilter:R},{"no-option":n(()=>[t(q,null,{default:n(()=>[t(_,{class:"text-grey"},{default:n(()=>e[28]||(e[28]=[y(" No se encontraron resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","disable","options"]),t(d,{modelValue:a(s).costo,"onUpdate:modelValue":e[22]||(e[22]=o=>a(s).costo=o),label:"Costo del libro",class:"required q-my-md",outlined:""},null,8,["modelValue"]),t(d,{modelValue:a(s).observacion,"onUpdate:modelValue":e[23]||(e[23]=o=>a(s).observacion=o),label:"Observaciones",class:"required q-my-md",type:"textarea",outlined:""},null,8,["modelValue"])]),_:1})])])]),_:1})]),_:1})]),_:1}))}};export{xe as default};
