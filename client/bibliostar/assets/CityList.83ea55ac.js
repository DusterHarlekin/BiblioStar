import{R as $,r as y,aw as T,V as I,W as S,X as s,$ as i,Z as a,x as V,_ as c,b2 as w,a2 as f,aA as N,Y as j}from"./index.3de14beb.js";import{Q as _}from"./QTooltip.2c191821.js";import{Q as z}from"./QTd.4e40a178.js";import{Q as A}from"./QTable.bd81f58f.js";import{Q as U}from"./QPage.ea495e0d.js";import"./QMenu.ba121aec.js";import"./QList.d82f2d18.js";import"./QSelect.dcde8888.js";import"./QItem.5c0ffacc.js";import"./format.054b8074.js";const B={class:"row justify-between items-center q-gutter-x-xl q-gutter-y-md q-mb-md q-pt-sm"},O={class:"col-md-6"},R={class:"row q-gutter-sm items-center"},L={class:"col-auto"},D={class:"row justify-between content-end items-center q-col-gutter-sm"},F={class:"col-auto"},G={class:"row items-center"},J={class:"col-xs-12 col-lg-auto"},W={class:"row items-center q-gutter-md"},X={class:"col-auto"},Y={class:"col-auto"},Z={class:"col-auto"},H={class:"col-auto self-end"},ce={__name:"CityList",setup(K){const u=$(),m=y({page:1,rowsPerPage:10,rowsNumber:0}),d=T({codigo_pais:"",codigo_ciudad:"",ciudad:""}),h=y([]),v=y(!1),x=[{name:"codigo_ciudad",label:"C\xF3digo de ciudad",field:o=>o.codigo_ciudad&&o.codigo_ciudad.trim()!=""?o.codigo_ciudad:"--",align:"left"},{name:"ciudad",label:"Ciudad",field:o=>o.ciudad&&o.ciudad.trim()!=""?o.ciudad:"--",align:"left"},{name:"codigo_pais",label:"C\xF3digo de pa\xEDs",field:o=>o.codigo_pais&&o.codigo_pais.trim()!=""?o.codigo_pais:"--",align:"left"},{name:"actions",label:"Acciones",align:"left"}],Q=o=>{u.dialog({title:"Eliminar ciudad",message:`\xBFEst\xE1s seguro de que deseas eliminar esta ciudad? (${o.ciudad})`,cancel:!0,persistent:!0}).onOk(async()=>{try{const e={method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({codigo_ciudad:o.codigo_ciudad,session_user_name:localStorage.getItem("usuario"),session_user_role:localStorage.getItem("rol")})},n=await fetch("http://localhost/bibliostar/API/ciudades.php",e);if(!n.ok)throw new Error(n.statusText);const r=await n.json();if(r.error)throw new Error(r.error);u.notify({color:"positive",position:"top",message:"Ciudad eliminada correctamente",icon:"mdi-check"}),g()}catch(e){u.notify({color:"negative",position:"top",message:e.message,icon:"mdi-alert"})}})},g=async(o=1)=>{var e,t,n;try{const r={method:"GET",headers:{"Content-Type":"application/json"}};let C=`http://localhost/bibliostar/API/ciudades.php?page=${o}&session_user_name=${localStorage.getItem("usuario")}&session_user_role=${localStorage.getItem("rol")}`,p=new URLSearchParams(d),q=[];p.forEach((b,k)=>{b.trim()==""&&q.push(k)}),q.forEach(b=>{p.delete(b)}),p.toString()!=""&&(C+=`&${p.toString()}`),v.value=!0;const l=await(await fetch(C,r)).json();h.value=l.data?l.data:[],m.value.rowsNumber=(e=l.pagination)!=null&&e.total?l.pagination.total:0,m.value.page=(t=l.pagination)!=null&&t.currentPage?l.pagination.currentPage:1,m.value.rowsPerPage=(n=l.pagination)!=null&&n.perPage?l.pagination.perPage:10}catch(r){u.notify({color:"negative",position:"top",message:r.message,icon:"mdi-alert"})}finally{v.value=!1}},E=o=>{g(o.pagination.page)},P=()=>{d.codigo_pais="",d.codigo_ciudad="",d.ciudad=""};return g(),(o,e)=>(I(),S(U,{class:"q-py-md q-px-lg"},{default:s(()=>[i("div",B,[i("div",O,[i("div",R,[a(V,{name:"mdi-home-city",size:"lg",color:"primary"}),e[5]||(e[5]=i("div",{class:"text-h4 text-weight-medium font-title"},"Ciudades",-1))])]),i("div",L,[a(c,{label:"Nueva Ciudad",icon:"mdi-plus-circle",color:"secondary","text-color":"white",to:"/ciudades/nuevo"})])]),a(N,{class:"q-pa-md q-mb-lg"},{default:s(()=>[i("div",D,[i("div",F,[i("div",G,[i("div",J,[i("div",W,[a(V,{name:"mdi-filter-variant",size:"lg",color:"grey-10"}),i("div",X,[a(w,{modelValue:d.ciudad,"onUpdate:modelValue":e[0]||(e[0]=t=>d.ciudad=t),outlined:"",dense:"",debounce:"400",label:"Ciudad"},null,8,["modelValue"])]),i("div",Y,[a(w,{modelValue:d.codigo_ciudad,"onUpdate:modelValue":e[1]||(e[1]=t=>d.codigo_ciudad=t),outlined:"",dense:"",debounce:"400",label:"C\xF3digo de ciudad"},null,8,["modelValue"])]),i("div",Z,[a(w,{modelValue:d.codigo_pais,"onUpdate:modelValue":e[2]||(e[2]=t=>d.codigo_pais=t),outlined:"",dense:"",debounce:"400",label:"C\xF3digo de pa\xEDs"},null,8,["modelValue"])])])])])]),i("div",H,[a(c,{flat:"",size:"lg","no-caps":"",icon:"mdi-eraser",color:"negative",onClick:P}),a(c,{flat:"",size:"lg","no-caps":"",icon:"mdi-reload",color:"primary",class:"q-ml-sm",onClick:e[3]||(e[3]=t=>g())},{default:s(()=>[a(_,null,{default:s(()=>e[6]||(e[6]=[f(" Actualizar tabla ")])),_:1})]),_:1})])])]),_:1}),a(A,{flat:"",dense:j(u).screen.lt.lg,bordered:"",pagination:m.value,"onUpdate:pagination":e[4]||(e[4]=t=>m.value=t),rows:h.value,columns:x,filter:d,loading:v.value,"row-key":"codigo_ciudad","rows-per-page-options":[],onRequest:E},{"body-cell-actions":s(t=>[a(z,{props:t},{default:s(()=>[a(c,{flat:"",round:"",icon:"mdi-eye",color:"positive",to:`/ciudades/ciudad/${t.row.codigo_ciudad}`},{default:s(()=>[a(_,null,{default:s(()=>e[7]||(e[7]=[f("Ver")])),_:1})]),_:2},1032,["to"]),a(c,{flat:"",round:"",icon:"mdi-lead-pencil",color:"accent",to:`/ciudades/editar/${t.row.codigo_ciudad}`},{default:s(()=>[a(_,null,{default:s(()=>e[8]||(e[8]=[f("Editar")])),_:1})]),_:2},1032,["to"]),a(c,{flat:"",round:"",icon:"mdi-delete-variant",color:"red",onClick:n=>Q(t.row)},{default:s(()=>[a(_,null,{default:s(()=>e[9]||(e[9]=[f("Eliminar")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["dense","pagination","rows","filter","loading"])]),_:1}))}};export{ce as default};
