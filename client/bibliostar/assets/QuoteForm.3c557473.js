import{R as h,P as q,b1 as V,r as w,aw as v,bb as x,V as C,W as I,X as d,$ as l,Z as a,_ as g,x as Q,a3 as S,Y as t,aA as k,az as j,b2 as n}from"./index.3de14beb.js";import{Q as E}from"./QForm.56ccee4c.js";import{Q as T}from"./QPage.ea495e0d.js";import{d as U}from"./date.ca83aab8.js";import"./format.054b8074.js";const $={class:"flex justify-between"},N={class:"row q-gutter-sm items-center q-mb-md q-pt-sm"},P={class:"text-h5 text-weight-medium font-title text-grey-9"},B={class:"text-right font-title"},D={class:"row"},Y={class:"col-12"},M={__name:"QuoteForm",setup(z){const m=h(),f=q(),c=V(),_=w(!1),u=!!(c.path.includes("editar")&&c.params.id),i=v({record:{cod_isbn:"",cota:"",cutter:"",volumen:"",ejemplar:"",cota_completa:"",fecha_ing:U.formatDate(Date.now(),"DD/MM/YYYY"),session_user_name:localStorage.getItem("usuario"),session_user_role:localStorage.getItem("rol")}}),y=async()=>{try{if(u){const r={method:"GET",headers:{"Content-Type":"application/json"}},o=`http://localhost/bibliostar/API/cotas.php?N=${c.params.id}&session_user_name=${localStorage.getItem("usuario")}&session_user_role=${localStorage.getItem("rol")}`,e=await fetch(o,r);if(!e.ok)throw new Error(e.statusText);const p=await e.json();if(p.error)throw new Error(p.error);i.record=p[0],i.record.session_user_name=localStorage.getItem("usuario"),i.record.session_user_role=localStorage.getItem("rol")}}catch(r){m.notify({color:"negative",position:"top",message:r.message,icon:"mdi-alert"})}},b=async()=>{try{const r={method:u?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i.record)},o=await fetch("http://localhost/bibliostar/API/cotas.php",r);if(!o.ok)throw new Error(o.statusText);const e=await o.json();if(e.error)throw new Error(e.error);m.notify({color:"positive",position:"top",message:e.success,icon:"mdi-checkbox-marked-circle"}),f.push({path:"/cotas"})}catch(r){m.notify({color:"negative",position:"top",message:r.message,icon:"mdi-alert"})}};y();const{record:s}=x(i);return(r,o)=>(C(),I(T,{class:"q-px-lg q-py-sm"},{default:d(()=>[l("div",$,[l("div",N,[a(g,{icon:"mdi-chevron-left",flat:"",color:"primary",padding:"none",to:"/cotas",size:"lg",class:"q-mr-sm"}),a(Q,{name:"mdi-bookmark",size:"md",color:"grey-9"}),l("div",P,S(t(u)?"Editar":"Nueva")+" Cota ",1)]),l("div",B,[a(g,{size:"md",class:"q-my-md",loading:_.value,color:"primary",padding:"sm md",icon:"mdi-check-circle-outline",label:"Guardar",onClick:b},null,8,["loading"])])]),a(E,null,{default:d(()=>[a(k,null,{default:d(()=>[l("div",D,[l("div",Y,[a(j,{class:"q-pb-none"},{default:d(()=>[a(n,{modelValue:t(s).cota,"onUpdate:modelValue":o[0]||(o[0]=e=>t(s).cota=e),label:"Cota",class:"required q-my-md",outlined:""},null,8,["modelValue"]),a(n,{modelValue:t(s).cod_isbn,"onUpdate:modelValue":o[1]||(o[1]=e=>t(s).cod_isbn=e),label:"C\xF3digo ISBN",class:"required q-my-md",outlined:""},null,8,["modelValue"]),a(n,{modelValue:t(s).cutter,"onUpdate:modelValue":o[2]||(o[2]=e=>t(s).cutter=e),label:"Cutter",class:"required q-my-md",outlined:""},null,8,["modelValue"]),a(n,{modelValue:t(s).cota_completa,"onUpdate:modelValue":o[3]||(o[3]=e=>t(s).cota_completa=e),label:"Cota completa",class:"required q-my-md",outlined:""},null,8,["modelValue"]),a(n,{modelValue:t(s).volumen,"onUpdate:modelValue":o[4]||(o[4]=e=>t(s).volumen=e),label:"Volumen",class:"required q-my-md",outlined:""},null,8,["modelValue"]),a(n,{modelValue:t(s).ejemplar,"onUpdate:modelValue":o[5]||(o[5]=e=>t(s).ejemplar=e),label:"Ejemplares",class:"required q-my-md",outlined:""},null,8,["modelValue"])]),_:1})])])]),_:1})]),_:1})]),_:1}))}};export{M as default};
