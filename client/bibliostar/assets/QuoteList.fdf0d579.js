import{R as S,r as N,aw as T,V as $,W as q,X as i,$ as s,Z as a,x as E,_ as p,b2 as v,a2 as y,aA as j,Y as O}from"./index.3de14beb.js";import{Q as h}from"./QTooltip.2c191821.js";import{Q as A}from"./QTd.4e40a178.js";import{Q as B}from"./QTable.bd81f58f.js";import{Q as U}from"./QPage.ea495e0d.js";import"./QMenu.ba121aec.js";import"./QList.d82f2d18.js";import"./QSelect.dcde8888.js";import"./QItem.5c0ffacc.js";import"./format.054b8074.js";const z={class:"row justify-between items-center q-gutter-x-xl q-gutter-y-md q-mb-md q-pt-sm"},L={class:"col-md-6"},R={class:"row q-gutter-sm items-center"},D={class:"col-auto"},F={class:"row justify-between content-end items-center q-col-gutter-sm"},J={class:"col-auto"},G={class:"row items-center"},M={class:"col-xs-12 col-lg-auto"},W={class:"row items-center q-gutter-md"},X={class:"col-auto"},Y={class:"col-auto"},Z={class:"col-auto"},H={class:"col-auto"},K={class:"col-auto self-end"},mt={__name:"QuoteList",setup(tt){const r=S(),g=N({page:1,rowsPerPage:10,rowsNumber:0}),l=T({cota:"",cod_isbn:"",cutter:"",cota_completa:""}),k=N([]),w=N(!1),V=[{name:"N",label:"N\xFAmero",field:"N",align:"left"},{name:"cota",label:"Cota",field:t=>t.cota&&t.cota.trim()!=""?t.cota:"--",align:"left"},{name:"cod_isbn",label:"C\xF3digo ISBN",field:t=>t.cod_isbn&&t.cod_isbn.trim()!=""?t.cod_isbn:"--",align:"left"},{name:"cutter",label:"Cutter",field:t=>t.cutter&&t.cutter.trim()!=""?t.cutter:"--",align:"left"},{name:"cota_completa",label:"Cota Completa",field:t=>t.cota_completa&&t.cota_completa.trim()!=""?t.cota_completa:"--",align:"left"},{name:"actions",label:"Acciones",align:"left"}],Q=t=>{r.dialog({title:"Eliminar cota",message:`\xBFEst\xE1s seguro de que deseas eliminar esta cota? (${t.cota})`,cancel:!0,persistent:!0}).onOk(async()=>{try{const e={method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({N:t.N,cota:t.cota,cod_isbn:t.cod_isbn,cutter:t.cutter,cota_completa:t.cota_completa,session_user_name:localStorage.getItem("usuario"),session_user_role:localStorage.getItem("rol")})},c=await fetch("http://localhost/bibliostar/API/cotas.php",e);if(!c.ok)throw new Error(c.statusText);const n=await c.json();if(n.error)throw new Error(n.error);n.bookFound?r.dialog({title:"Libro encontrado",message:n.foundMessage,cancel:!0,persistent:!0}).onOk(async()=>{try{const m="http://localhost/bibliostar/API/cotas.php",u={method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({N:t.N,cota:t.cota,cod_isbn:t.cod_isbn,cutter:t.cutter,cota_completa:t.cota_completa,session_user_name:localStorage.getItem("usuario"),session_user_role:localStorage.getItem("rol"),confirmed:!0})},_=await fetch(m,u);if(!_.ok)throw new Error(c.statusText);const b=await _.json();if(b.error)throw new Error(b.error);r.notify({color:"positive",position:"top",message:b.success,icon:"mdi-check"}),f()}catch(m){r.notify({color:"negative",position:"top",message:m.message,icon:"mdi-alert"})}}):(r.notify({color:"positive",position:"top",message:n.success,icon:"mdi-check"}),f())}catch(e){r.notify({color:"negative",position:"top",message:e.message,icon:"mdi-alert"})}})},f=async(t=1)=>{var e,o,c;try{const n={method:"GET",headers:{"Content-Type":"application/json"}};let m=`http://localhost/bibliostar/API/cotas.php?page=${t}&session_user_name=${localStorage.getItem("usuario")}&session_user_role=${localStorage.getItem("rol")}`,u=new URLSearchParams(l),_=[];u.forEach((C,P)=>{C.trim()==""&&_.push(P)}),_.forEach(C=>{u.delete(C)}),u.toString()!=""&&(m+=`&${u.toString()}`),w.value=!0;const d=await(await fetch(m,n)).json();k.value=d.data?d.data:[],g.value.rowsNumber=(e=d.pagination)!=null&&e.total?d.pagination.total:0,g.value.page=(o=d.pagination)!=null&&o.currentPage?d.pagination.currentPage:1,g.value.rowsPerPage=(c=d.pagination)!=null&&c.perPage?d.pagination.perPage:10}catch(n){r.notify({color:"negative",position:"top",message:n.message,icon:"mdi-alert"})}finally{w.value=!1}},x=t=>{f(t.pagination.page)},I=()=>{l.cota="",l.cod_isbn="",l.cutter="",l.cota_completa=""};return f(),(t,e)=>($(),q(U,{class:"q-py-md q-px-lg"},{default:i(()=>[s("div",z,[s("div",L,[s("div",R,[a(E,{name:"mdi-bookmark",size:"lg",color:"primary"}),e[6]||(e[6]=s("div",{class:"text-h4 text-weight-medium font-title"},"Cotas",-1))])]),s("div",D,[a(p,{label:"Nueva cota",icon:"mdi-plus-circle",color:"secondary","text-color":"white",to:"/cotas/nuevo"})])]),a(j,{class:"q-pa-md q-mb-lg"},{default:i(()=>[s("div",F,[s("div",J,[s("div",G,[s("div",M,[s("div",W,[a(E,{name:"mdi-filter-variant",size:"lg",color:"grey-10"}),s("div",X,[a(v,{modelValue:l.cota,"onUpdate:modelValue":e[0]||(e[0]=o=>l.cota=o),outlined:"",dense:"",debounce:"400",label:"Cota"},null,8,["modelValue"])]),s("div",Y,[a(v,{modelValue:l.cod_isbn,"onUpdate:modelValue":e[1]||(e[1]=o=>l.cod_isbn=o),outlined:"",dense:"",debounce:"400",label:"C\xF3digo ISBN"},null,8,["modelValue"])]),s("div",Z,[a(v,{modelValue:l.cutter,"onUpdate:modelValue":e[2]||(e[2]=o=>l.cutter=o),outlined:"",dense:"",debounce:"400",label:"Cutter"},null,8,["modelValue"])]),s("div",H,[a(v,{modelValue:l.cota_completa,"onUpdate:modelValue":e[3]||(e[3]=o=>l.cota_completa=o),outlined:"",dense:"",debounce:"400",label:"Cota Completa"},null,8,["modelValue"])])])])])]),s("div",K,[a(p,{flat:"",size:"lg","no-caps":"",icon:"mdi-eraser",color:"negative",onClick:I}),a(p,{flat:"",size:"lg","no-caps":"",icon:"mdi-reload",color:"primary",class:"q-ml-sm",onClick:e[4]||(e[4]=o=>f())},{default:i(()=>[a(h,null,{default:i(()=>e[7]||(e[7]=[y(" Actualizar tabla ")])),_:1})]),_:1})])])]),_:1}),a(B,{flat:"",dense:O(r).screen.lt.lg,bordered:"",pagination:g.value,"onUpdate:pagination":e[5]||(e[5]=o=>g.value=o),rows:k.value,columns:V,filter:l,loading:w.value,"row-key":"N","rows-per-page-options":[],onRequest:x},{"body-cell-actions":i(o=>[a(A,{props:o},{default:i(()=>[a(p,{flat:"",round:"",icon:"mdi-eye",color:"positive",to:`/cotas/cota/${o.row.N}`},{default:i(()=>[a(h,null,{default:i(()=>e[8]||(e[8]=[y("Ver")])),_:1})]),_:2},1032,["to"]),a(p,{flat:"",round:"",icon:"mdi-lead-pencil",color:"accent",to:`/cotas/editar/${o.row.N}`},{default:i(()=>[a(h,null,{default:i(()=>e[9]||(e[9]=[y("Editar")])),_:1})]),_:2},1032,["to"]),a(p,{flat:"",round:"",icon:"mdi-delete-variant",color:"red",onClick:c=>Q(o.row)},{default:i(()=>[a(h,null,{default:i(()=>e[10]||(e[10]=[y("Eliminar")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["dense","pagination","rows","filter","loading"])]),_:1}))}};export{mt as default};
