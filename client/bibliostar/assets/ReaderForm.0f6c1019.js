import{R as q,aw as S,bb as F,V as k,W as I,X as n,Y as l,b0 as Q,Z as t,az as p,$ as U,a3 as _,b2 as s,bd as T,_ as f,aA as v}from"./index.3de14beb.js";import{Q as D}from"./QForm.56ccee4c.js";import{u as g}from"./use-dialog-plugin-component.65dc1751.js";const B={class:"text-h6"},P={__name:"ReaderForm",props:{isEditForm:{type:Boolean,default:!1},creatingFromLoan:{type:Boolean,default:!1},cedula:{type:String,default:null}},emits:[...g.emits],setup(u){const m=q(),{dialogRef:b,onDialogHide:V,onDialogOK:y,onDialogCancel:w}=g(),d=u,i=S({record:{cedula:"",nombre:"",apellido:"",edad:"",sexo:"",telefono:"",correo:"",direccion:"",session_user_name:localStorage.getItem("usuario"),session_user_role:localStorage.getItem("rol")}}),x=async()=>{try{if(d.isEditForm){const r={method:"GET",headers:{"Content-Type":"application/json"}},o=`http://localhost/bibliostar/API/lectores.php?cedula=${d.cedula}&session_user_name=${localStorage.getItem("usuario")}&session_user_role=${localStorage.getItem("rol")}`,e=await fetch(o,r);if(!e.ok)throw new Error(e.statusText);const c=await e.json();if(c.error)throw new Error(c.error);i.record=c.data[0],i.record.session_user_name=localStorage.getItem("usuario"),i.record.session_user_role=localStorage.getItem("rol")}}catch(r){m.notify({color:"negative",position:"top",message:r.message,icon:"mdi-alert"})}},C=async()=>{try{const r={method:d.isEditForm?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i.record)},o=await fetch("http://localhost/bibliostar/API/lectores.php",r);if(!o.ok)throw new Error(o.statusText);const e=await o.json();if(e.error)throw new Error(e.error);m.notify({color:"positive",position:"top",message:e.success,icon:"mdi-checkbox-marked-circle"}),y({reader:i.record})}catch(r){m.notify({color:"negative",position:"top",message:r.message,icon:"mdi-alert"})}},h=()=>w();d.isEditForm&&x();const{record:a,isLoading:E}=F(i);return(r,o)=>(k(),I(Q,{ref_key:"dialogRef",ref:b,medium:"","full-height":"",maximized:"",position:"right",onHide:l(V)},{default:n(()=>[t(v,{class:"q-pa-md",style:{width:"500px","max-width":"100vw"}},{default:n(()=>[t(p,null,{default:n(()=>[U("div",B,_(u.isEditForm?"Editar":"Nuevo")+" Lector",1)]),_:1}),t(D,{onSubmit:C},{default:n(()=>[t(p,null,{default:n(()=>[t(s,{disable:u.isEditForm,modelValue:l(a).cedula,"onUpdate:modelValue":o[0]||(o[0]=e=>l(a).cedula=e),label:"C\xE9dula",class:"required"},null,8,["disable","modelValue"]),t(s,{modelValue:l(a).nombre,"onUpdate:modelValue":o[1]||(o[1]=e=>l(a).nombre=e),label:"Nombre",class:"required"},null,8,["modelValue"]),t(s,{modelValue:l(a).apellido,"onUpdate:modelValue":o[2]||(o[2]=e=>l(a).apellido=e),label:"Apellido",class:"required"},null,8,["modelValue"]),t(s,{modelValue:l(a).edad,"onUpdate:modelValue":o[3]||(o[3]=e=>l(a).edad=e),label:"Edad",class:"required"},null,8,["modelValue"]),t(s,{modelValue:l(a).sexo,"onUpdate:modelValue":o[4]||(o[4]=e=>l(a).sexo=e),label:"sexo",class:"required"},null,8,["modelValue"]),t(s,{modelValue:l(a).telefono,"onUpdate:modelValue":o[5]||(o[5]=e=>l(a).telefono=e),label:"Tel\xE9fono",class:"required"},null,8,["modelValue"]),t(s,{modelValue:l(a).correo,"onUpdate:modelValue":o[6]||(o[6]=e=>l(a).correo=e),label:"Correo",class:"required"},null,8,["modelValue"]),t(s,{modelValue:l(a).direccion,"onUpdate:modelValue":o[7]||(o[7]=e=>l(a).direccion=e),label:"Direcci\xF3n",class:"required",type:"textarea"},null,8,["modelValue"])]),_:1}),t(T,null,{default:n(()=>[t(f,{loading:l(E),type:"submit",color:"primary",label:"Guardar",padding:"xs xl"},null,8,["loading"]),t(f,{flat:"",label:"Cancelar",onClick:h})]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"]))}};export{P as _};
