import{R as L,S as O,r as w,aw as Y,V as u,W as q,X as i,$ as s,Z as a,x as R,Y as m,_ as d,a0 as Q,b2 as _,t as T,v as F,a2 as y,a6 as S,a3 as $,aA as G}from"./index.3de14beb.js";import{Q as M}from"./QSelect.dcde8888.js";import{a as I}from"./QItem.5c0ffacc.js";import{Q as H,a as J,C as W}from"./ClosePopup.8133d9f3.js";import{Q as k}from"./QTooltip.2c191821.js";import{Q as X}from"./QTd.4e40a178.js";import{Q as Z}from"./QTable.bd81f58f.js";import{Q as K}from"./QPage.ea495e0d.js";import"./QMenu.ba121aec.js";import"./format.054b8074.js";import"./date.ca83aab8.js";import"./QList.d82f2d18.js";const ee={class:"row justify-between items-center q-gutter-x-xl q-gutter-y-md q-mb-md q-pt-sm"},te={class:"col-md-6"},oe={class:"row q-gutter-sm items-center"},ae={class:"col-auto"},le={class:"row justify-between content-end items-center q-col-gutter-sm"},se={class:"col-auto"},ie={class:"row items-center"},ne={class:"col-xs-12 col-lg-auto"},re={class:"row items-center q-gutter-md"},de={class:"col-auto"},ce={class:"col-auto"},ue={class:"col-auto"},me={class:"col-auto"},pe={class:"col-auto"},fe={class:"col-auto"},ge={class:"row items-center q-gutter-md q-mt-md"},_e={class:"row items-center justify-end"},be={key:0,caption:"",class:"text-weight-medium"},ve={key:1,caption:"",class:"text-weight-medium"},we={key:2,caption:"",class:"text-weight-medium"},ye={class:"col-auto self-end"},Ae={__name:"BookList",setup(he){const p=L(),f=O(),b=w({page:1,rowsPerPage:10,rowsNumber:0}),e=Y({titulo:"",autor:"",editorial:"",cota_completa:"",cod_sala:"",date:"",anio:"",cod_isbn:""}),h=w([]),C=w([]),v=w(!1),E=w(!1),A=[{name:"N",label:"N\xFAmero",field:"N",align:"left"},{name:"cota_completa",label:"Cota completa",field:n=>n.cota_completa&&n.cota_completa.trim()!=""?n.cota_completa:"--",align:"left"},{name:"titulo",label:"T\xEDtulo",field:"titulo",classes:"text-capitalize",align:"left"},{name:"autor",label:"Autor",field:"autor",classes:"text-capitalize",align:"left"},{name:"editorial",label:"Editorial",field:"editorial",classes:"text-capitalize",align:"left"},{name:"edicion",label:"Edici\xF3n",field:"edicion",align:"left"},{name:"cod_sala",label:"Sala",field:"cod_sala",align:"left"},{name:"actions",label:"Acciones",align:"left"}],U=n=>{p.dialog({title:"Eliminar libro",message:`\xBFEst\xE1s seguro de que deseas eliminar este libro? (${n.titulo})`,cancel:!0,persistent:!0}).onOk(async()=>{try{const t={method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({N:n.N,session_user_name:localStorage.getItem("usuario"),session_user_role:localStorage.getItem("rol")})},r=await fetch("http://localhost/bibliostar/API/libros.php",t);if(!r.ok)throw new Error(r.statusText);const g=await r.json();if(g.error)throw new Error(g.error);p.notify({color:"positive",position:"top",message:"Libro eliminado correctamente",icon:"mdi-check"}),V()}catch(t){p.notify({color:"negative",position:"top",message:t.message,icon:"mdi-alert"})}})},V=async(n=1)=>{var t,o,r;try{const g={method:"GET",headers:{"Content-Type":"application/json"}};let N=`http://localhost/bibliostar/API/libros.php?page=${n}&session_user_name=${localStorage.getItem("usuario")}&session_user_role=${localStorage.getItem("rol")}`,l=new URLSearchParams(e);e.date?(l.set("dateQuery","fecha_ing"),l.delete("titulo"),l.delete("cod_isbn"),l.delete("autor"),l.delete("editorial"),l.delete("cota_completa"),l.delete("cod_sala"),l.delete("anio"),l.set("titulo",e.titulo),l.set("cod_isbn",e.cod_isbn),l.set("autor",e.autor),l.set("editorial",e.editorial),l.set("cota_completa",e.cota_completa),l.set("cod_sala",e.cod_sala),l.set("anio",e.anio)):l.delete("date"),e.date&&e.date.from&&e.date.to&&(l.set("date_from",e.date.from),l.set("date_to",e.date.to),l.delete("date"));let P=[];l.forEach((x,D)=>{(x==null||x.trim()=="")&&P.push(D)}),P.forEach(x=>{l.delete(x)}),l.toString()!=""&&(N+=`&${l.toString()}`),E.value=!0;const c=await(await fetch(N,g)).json();C.value=c.data?c.data:[],b.value.rowsNumber=(t=c.pagination)!=null&&t.total?c.pagination.total:0,b.value.page=(o=c.pagination)!=null&&o.currentPage?c.pagination.currentPage:1,b.value.rowsPerPage=(r=c.pagination)!=null&&r.perPage?c.pagination.perPage:10}catch(g){p.notify({color:"negative",position:"top",message:g.message,icon:"mdi-alert"})}finally{E.value=!1}},j=n=>{V(n.pagination.page)},z=async()=>{try{const n={method:"GET",headers:{"Content-Type":"application/json"}},t=await fetch(`http://localhost/bibliostar/API/salas.php?session_user_name=${localStorage.getItem("usuario")}&session_user_role=${localStorage.getItem("rol")}`,n);if(!t.ok)throw new Error(t.statusText);const o=await t.json();h.value=[],h.value.push({label:"Todas",value:""});for(const r of o.data)h.value.push({label:r.cod_sala,value:r.cod_sala});if(o.error)throw new Error(o.error)}catch(n){p.notify({color:"negative",position:"top",message:n.message,icon:"mdi-alert"})}},B=()=>{e.titulo="",e.autor="",e.editorial="",e.cutter="",e.cod_sala="",e.anio="",e.date=null};return z(),V(),(n,t)=>(u(),q(K,{class:"q-py-md q-px-lg"},{default:i(()=>[s("div",ee,[s("div",te,[s("div",oe,[a(R,{name:"mdi-book",size:"lg",color:"primary"}),t[11]||(t[11]=s("div",{class:"text-h4 text-weight-medium font-title"},"Libros",-1))])]),s("div",ae,[m(f).rol==="admin"||m(f).rol==="librarian"?(u(),q(d,{key:0,label:"Nuevo libro",icon:"mdi-plus-circle",color:"secondary","text-color":"white",to:"/libros/nuevo"})):Q("",!0)])]),a(G,{class:"q-pa-md q-mb-lg"},{default:i(()=>[s("div",le,[s("div",se,[s("div",ie,[s("div",ne,[s("div",re,[a(d,{onClick:t[0]||(t[0]=o=>v.value=!v.value),size:"lg",icon:v.value?"mdi-filter-variant-minus":"mdi-filter-variant-plus",flat:"",class:"text-weight-semibold",color:v.value?"grey-8":"primary"},null,8,["icon","color"]),s("div",de,[a(_,{modelValue:e.titulo,"onUpdate:modelValue":t[1]||(t[1]=o=>e.titulo=o),outlined:"",dense:"",debounce:"400",label:"T\xEDtulo"},null,8,["modelValue"])]),s("div",ce,[a(_,{modelValue:e.autor,"onUpdate:modelValue":t[2]||(t[2]=o=>e.autor=o),outlined:"",dense:"",debounce:"400",label:"Autor"},null,8,["modelValue"])]),s("div",ue,[a(_,{modelValue:e.editorial,"onUpdate:modelValue":t[3]||(t[3]=o=>e.editorial=o),outlined:"",dense:"",debounce:"400",label:"Editorial"},null,8,["modelValue"])]),s("div",me,[a(_,{modelValue:e.cota_completa,"onUpdate:modelValue":t[4]||(t[4]=o=>e.cota_completa=o),outlined:"",dense:"",debounce:"400",label:"Cota completa"},null,8,["modelValue"])]),s("div",pe,[a(_,{modelValue:e.cod_isbn,"onUpdate:modelValue":t[5]||(t[5]=o=>e.cod_isbn=o),outlined:"",dense:"",debounce:"400",label:"C\xF3digo ISBN"},null,8,["modelValue"])]),s("div",fe,[a(M,{modelValue:e.cod_sala,"onUpdate:modelValue":t[6]||(t[6]=o=>e.cod_sala=o),style:{"min-width":"140px"},"map-options":"",dense:"",outlined:"","emit-value":"",options:h.value,label:"Sala"},null,8,["modelValue","options"])])]),T(s("div",ge,[a(_,{modelValue:e.anio,"onUpdate:modelValue":t[7]||(t[7]=o=>e.anio=o),outlined:"",dense:"",debounce:"400",label:"A\xF1o de publicaci\xF3n"},null,8,["modelValue"]),a(I,{class:"q-ml-lg"},{default:i(()=>t[12]||(t[12]=[y("Fecha de ingreso:")])),_:1}),a(d,{color:"primary",flat:"",icon:"mdi-calendar",class:"cursor-pointer q-pa-sm q-ml-xs",rounded:""},{default:i(()=>[a(H,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:i(()=>[a(J,{mask:"DD/MM/YYYY",range:"",modelValue:e.date,"onUpdate:modelValue":t[8]||(t[8]=o=>e.date=o)},{default:i(()=>[s("div",_e,[T(a(d,{label:"Close",color:"primary",flat:""},null,512),[[W]])])]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(I,{caption:"",class:"q-ml-xs"},{default:i(()=>[e.date&&e.date.from?(u(),S("span",be,"Desde "+$(e.date.from&&e.date.to?e.date.from+" Hasta "+e.date.to:e.date.from),1)):e.date&&!e.date.from?(u(),S("span",ve,$(e.date),1)):(u(),S("span",we,"Todas"))]),_:1})],512),[[F,v.value]])])])]),s("div",ye,[a(d,{flat:"",size:"lg","no-caps":"",icon:"mdi-eraser",color:"negative",onClick:B}),a(d,{flat:"",size:"lg","no-caps":"",icon:"mdi-reload",color:"primary",class:"q-ml-sm",onClick:t[9]||(t[9]=o=>V())},{default:i(()=>[a(k,null,{default:i(()=>t[13]||(t[13]=[y(" Actualizar tabla ")])),_:1})]),_:1})])])]),_:1}),a(Z,{flat:"",dense:m(p).screen.lt.lg,bordered:"",pagination:b.value,"onUpdate:pagination":t[10]||(t[10]=o=>b.value=o),rows:C.value,columns:A,filter:e,loading:E.value,"row-key":"N","rows-per-page-options":[],onRequest:j},{"body-cell-actions":i(o=>[a(X,{props:o},{default:i(()=>[a(d,{flat:"",round:"",icon:"mdi-eye",color:"positive",to:`/libros/libro/${o.row.N}`},{default:i(()=>[a(k,null,{default:i(()=>t[14]||(t[14]=[y("Ver")])),_:1})]),_:2},1032,["to"]),m(f).rol==="admin"||m(f).rol==="librarian"?(u(),q(d,{key:0,flat:"",round:"",icon:"mdi-lead-pencil",color:"accent",to:`/libros/editar/${o.row.N}`},{default:i(()=>[a(k,null,{default:i(()=>t[15]||(t[15]=[y("Editar")])),_:1})]),_:2},1032,["to"])):Q("",!0),m(f).rol==="admin"||m(f).rol==="librarian"?(u(),q(d,{key:1,flat:"",round:"",icon:"mdi-delete-variant",color:"red",onClick:r=>U(o.row)},{default:i(()=>[a(k,null,{default:i(()=>t[16]||(t[16]=[y("Eliminar")])),_:1})]),_:2},1032,["onClick"])):Q("",!0)]),_:2},1032,["props"])]),_:1},8,["dense","pagination","rows","filter","loading"])]),_:1}))}};export{Ae as default};
