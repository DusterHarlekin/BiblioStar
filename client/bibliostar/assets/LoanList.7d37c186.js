import{R as B,S as L,r as v,aw as U,V as m,W as V,X as i,$ as l,Z as o,x as T,_ as r,b2 as k,t as A,a6 as Q,a3 as E,a2 as y,aA as F,Y as _,a0 as I}from"./index.3de14beb.js";import{Q as Y}from"./QSelect.dcde8888.js";import{Q as O,a as R,C as M}from"./ClosePopup.8133d9f3.js";import{a as G}from"./QItem.5c0ffacc.js";import{Q as w}from"./QTooltip.2c191821.js";import{Q as H}from"./QTd.4e40a178.js";import{Q as J}from"./QTable.bd81f58f.js";import{Q as W}from"./QPage.ea495e0d.js";import"./QMenu.ba121aec.js";import"./format.054b8074.js";import"./date.ca83aab8.js";import"./QList.d82f2d18.js";const X={class:"row justify-between items-center q-gutter-x-xl q-gutter-y-md q-mb-md q-pt-sm"},Z={class:"col-md-6"},K={class:"row q-gutter-sm items-center"},ee={class:"col-md-auto q-gutter-md flex justify-evenly"},te={class:"row justify-between content-end items-center q-col-gutter-sm"},oe={class:"col-auto"},ae={class:"row items-center"},se={class:"col-xs-12 col-lg-auto"},le={class:"row items-center q-gutter-md"},ie={class:"col-auto"},ne={class:"col-auto"},re={class:"col-auto"},de={class:"col-auto flex no-wrap items-center"},ce={class:"row items-center justify-center q-gutter-md"},ue={class:"q-ml-lg"},me={class:"row items-center justify-end"},pe={key:0,caption:"",class:"text-weight-medium"},fe={key:1,caption:"",class:"text-weight-medium"},ge={key:2,caption:"",class:"text-weight-medium"},_e={class:"col-auto self-end"},Ee={__name:"LoanList",setup(be){const p=B(),b=L(),f=v({page:1,rowsPerPage:10,rowsNumber:0}),x=v("fecha_s"),e=U({titulo:"",cod_isbn:"",cedula:"",date:""}),C=v([]),q=v(!1),N=[{name:"cedula",label:"C\xE9dula",field:"cedula",align:"left"},{name:"cod_isbn",label:"C\xF3digo ISBN",field:a=>a.cod_isbn&&a.cod_isbn.trim()!=""?a.cod_isbn:"--",align:"left"},{name:"titulo",label:"T\xEDtulo",field:"titulo",classes:"text-capitalize",align:"left"},{name:"fecha_s",label:"Fecha de salida",field:a=>a.fecha_s&&a.fecha_s.trim()!=""?a.fecha_s+" "+a.hora_s:"--",classes:"text-capitalize",align:"left"},{name:"fecha_e",label:"Fecha de entrega",field:a=>a.fecha_e&&a.fecha_e.trim()!=""?a.fecha_e+" "+a.hora_e:"--",classes:"text-capitalize",align:"left"},{name:"actions",label:"Acciones",align:"left"}],$=a=>{p.dialog({title:"Confirmar devoluci\xF3n",message:`\xBFEst\xE1s seguro de que deseas confirmar la devoluci\xF3\u0301n de este libro? (${a.titulo})`,cancel:!0,persistent:!0}).onOk(async()=>{try{const t={method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({cod_isbn:a.cod_isbn,session_user_name:localStorage.getItem("usuario"),session_user_role:localStorage.getItem("rol")})},c=await fetch("http://localhost/bibliostar/API/prestamos.php",t);if(!c.ok)throw new Error(c.statusText);const u=await c.json();if(u.error)throw new Error(u.error);p.notify({color:"positive",position:"top",message:u.success,icon:"mdi-check"}),g()}catch(t){p.notify({color:"negative",position:"top",message:t.message,icon:"mdi-alert"})}})},g=async(a=1)=>{var t,s,c;try{const u={method:"GET",headers:{"Content-Type":"application/json"}};let P=`http://localhost/bibliostar/API/prestamos.php?page=${a}&session_user_name=${localStorage.getItem("usuario")}&session_user_role=${localStorage.getItem("rol")}`,n=new URLSearchParams(e),S=[];n.forEach((h,D)=>{(h==null||h.trim()=="")&&S.push(D)}),e.date?(n.set("dateQuery",x.value),n.delete("titulo"),n.delete("cod_isbn"),n.delete("cedula"),n.set("titulo",e.titulo),n.set("cod_isbn",e.cod_isbn),n.set("cedula",e.cedula)):n.delete("date"),e.date&&e.date.from&&e.date.to&&(n.set("date_from",e.date.from),n.set("date_to",e.date.to),n.delete("date")),S.forEach(h=>{n.delete(h)}),n.toString()!=""&&(P+=`&${n.toString()}`),q.value=!0;const d=await(await fetch(P,u)).json();C.value=d.data?d.data:[],f.value.rowsNumber=(t=d.pagination)!=null&&t.total?d.pagination.total:0,f.value.page=(s=d.pagination)!=null&&s.currentPage?d.pagination.currentPage:1,f.value.rowsPerPage=(c=d.pagination)!=null&&c.perPage?d.pagination.perPage:10}catch(u){p.notify({color:"negative",position:"top",message:u.message,icon:"mdi-alert"})}finally{q.value=!1}},j=a=>{g(a.pagination.page)},z=()=>{e.titulo="",e.cedula="",e.cod_isbn="",e.date=null};return g(),(a,t)=>(m(),V(W,{class:"q-py-md q-px-lg"},{default:i(()=>[l("div",X,[l("div",Z,[l("div",K,[o(T,{name:"mdi-account-clock",size:"lg",color:"primary"}),t[7]||(t[7]=l("div",{class:"text-h4 text-weight-medium font-title"},"Pr\xE9stamos",-1))])]),l("div",ee,[l("div",null,[o(r,{label:"Ver Lectores",icon:"mdi-eye",color:"primary","text-color":"primary",outline:"",to:"/lectores"})]),l("div",null,[o(r,{label:"Nuevo prestamo",icon:"mdi-plus-circle",color:"secondary","text-color":"white",to:"/prestamos/nuevo"})])])]),o(F,{class:"q-pa-md q-mb-lg"},{default:i(()=>[l("div",te,[l("div",oe,[l("div",ae,[l("div",se,[l("div",le,[o(T,{name:"mdi-filter-variant",size:"lg",color:"grey-10"}),l("div",ie,[o(k,{modelValue:e.titulo,"onUpdate:modelValue":t[0]||(t[0]=s=>e.titulo=s),outlined:"",dense:"",debounce:"400",label:"T\xEDtulo"},null,8,["modelValue"])]),l("div",ne,[o(k,{modelValue:e.cod_isbn,"onUpdate:modelValue":t[1]||(t[1]=s=>e.cod_isbn=s),outlined:"",dense:"",debounce:"400",label:"C\xF3digo ISBN"},null,8,["modelValue"])]),l("div",re,[o(k,{modelValue:e.cedula,"onUpdate:modelValue":t[2]||(t[2]=s=>e.cedula=s),outlined:"",dense:"",debounce:"400",label:"C\xE9dula"},null,8,["modelValue"])]),l("div",de,[l("div",ce,[l("div",ue,[o(Y,{modelValue:x.value,"onUpdate:modelValue":[t[3]||(t[3]=s=>x.value=s),g],style:{"min-width":"140px"},"map-options":"",dense:"",outlined:"","emit-value":"",options:[{label:"Fecha de salida",value:"fecha_s"},{label:"Fecha de entrega",value:"fecha_e"}],label:"Tipo de fecha"},null,8,["modelValue"])]),o(r,{color:"primary",flat:"",icon:"mdi-calendar",class:"cursor-pointer q-pa-sm q-ml-xs",rounded:""},{default:i(()=>[o(O,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:i(()=>[o(R,{mask:"DD/MM/YYYY",range:"",modelValue:e.date,"onUpdate:modelValue":t[4]||(t[4]=s=>e.date=s)},{default:i(()=>[l("div",me,[A(o(r,{label:"Close",color:"primary",flat:""},null,512),[[M]])])]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(G,{caption:"",class:"q-ml-xs"},{default:i(()=>[e.date&&e.date.from?(m(),Q("span",pe,"Desde "+E(e.date.from&&e.date.to?e.date.from+" Hasta "+e.date.to:e.date.from),1)):e.date&&!e.date.from?(m(),Q("span",fe,E(e.date),1)):(m(),Q("span",ge,"Todas"))]),_:1})])])])])])]),l("div",_e,[o(r,{flat:"",size:"lg","no-caps":"",icon:"mdi-eraser",color:"negative",onClick:z}),o(r,{flat:"",size:"lg","no-caps":"",icon:"mdi-reload",color:"primary",class:"q-ml-sm",onClick:t[5]||(t[5]=s=>g())},{default:i(()=>[o(w,null,{default:i(()=>t[8]||(t[8]=[y(" Actualizar tabla ")])),_:1})]),_:1})])])]),_:1}),o(J,{flat:"",dense:_(p).screen.lt.lg,bordered:"",pagination:f.value,"onUpdate:pagination":t[6]||(t[6]=s=>f.value=s),rows:C.value,columns:N,filter:e,loading:q.value,"row-key":"N","rows-per-page-options":[],onRequest:j},{"body-cell-actions":i(s=>[o(H,{props:s},{default:i(()=>[o(r,{flat:"",round:"",icon:"mdi-eye",color:"positive",to:`/prestamos/prestamo/${s.row.cod_isbn}`},{default:i(()=>[o(w,null,{default:i(()=>t[9]||(t[9]=[y("Ver")])),_:1})]),_:2},1032,["to"]),_(b).rol==="admin"||_(b).rol==="librarian"?(m(),V(r,{key:0,flat:"",round:"",icon:"mdi-lead-pencil",color:"accent",to:`/prestamos/editar/${s.row.cod_isbn}`},{default:i(()=>[o(w,null,{default:i(()=>t[10]||(t[10]=[y("Editar")])),_:1})]),_:2},1032,["to"])):I("",!0),_(b).rol==="admin"||_(b).rol==="librarian"?(m(),V(r,{key:1,flat:"",round:"",icon:"mdi-check-circle",color:"secondary",onClick:c=>$(s.row)},{default:i(()=>[o(w,null,{default:i(()=>t[11]||(t[11]=[y("Confirmar entrega")])),_:1})]),_:2},1032,["onClick"])):I("",!0)]),_:2},1032,["props"])]),_:1},8,["dense","pagination","rows","filter","loading"])]),_:1}))}};export{Ee as default};
